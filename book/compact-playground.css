/**
 * Compact Playground Styles
 *
 * Styles for interactive Compact code blocks in mdBook
 * Compatible with both light and dark themes
 */

/* Wrapper for the entire playground */
.compact-playground-wrapper {
  position: relative;
  margin: 1rem 0;
  border-radius: 8px;
  overflow: hidden;
  background: #f6f8fa !important;
  border: 1px solid #e1e4e8 !important;
  box-shadow: none !important;
}

/* Light theme explicit styles */
.light .compact-playground-wrapper,
.rust .compact-playground-wrapper {
  background: #f6f8fa !important;
  border-color: #e1e4e8 !important;
}

.light .compact-playground-wrapper pre,
.rust .compact-playground-wrapper pre,
.light .compact-playground-wrapper pre code,
.rust .compact-playground-wrapper pre code,
.light .compact-playground-wrapper pre code.hljs,
.rust .compact-playground-wrapper pre code.hljs,
.light .compact-playground-wrapper .hljs,
.rust .compact-playground-wrapper .hljs {
  color: #24292e;
  background: transparent !important;
  background-color: transparent !important;
}

/* Make the pre element fit within the wrapper - override custom.css */
.compact-playground-wrapper pre {
  margin: 0 !important;
  border: none !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  padding: 0 !important;
  background: transparent !important;
  background-color: transparent !important;
}

.compact-playground-wrapper pre code,
.compact-playground-wrapper pre code.hljs,
.compact-playground-wrapper .hljs {
  display: block;
  padding: 1rem;
  padding-bottom: 0.5rem;
  min-height: 40px;
  outline: none;
  white-space: pre;
  overflow-x: auto;
  background: transparent !important;
  background-color: transparent !important;
}

/* Ensure no extra content after code */
.compact-playground-wrapper pre code::after {
  content: none !important;
  display: none !important;
}

/* Editable code styling */
.compact-editable {
  cursor: text;
}

.compact-editable:focus {
  background: var(--code-focus-bg, rgba(0, 0, 0, 0.02));
}

/* Toolbar */
.compact-playground-toolbar {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem;
  background: var(--toolbar-bg, #e8e8e8);
  border-bottom: 1px solid var(--border-color, #e0e0e0);
}

/* Editable indicator */
.compact-editable-indicator {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  margin-left: auto;
  padding: 0.3rem 0.6rem;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--editable-color, #1976d2);
  background: var(--editable-bg, rgba(25, 118, 210, 0.1));
  border-radius: 4px;
  border: 1px solid var(--editable-border, rgba(25, 118, 210, 0.3));
}

.compact-editable-indicator svg {
  width: 12px;
  height: 12px;
  opacity: 0.7;
}

/* Buttons */
.compact-playground-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.4rem 0.75rem;
  font-size: 0.85rem;
  font-family: inherit;
  font-weight: 500;
  color: var(--btn-text, #333);
  background: var(--btn-bg, #fff);
  border: 1px solid var(--border-color, #ccc);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.compact-playground-btn:hover:not(:disabled) {
  background: var(--btn-hover-bg, #f0f0f0);
  border-color: var(--btn-hover-border, #999);
}

.compact-playground-btn:active:not(:disabled) {
  transform: translateY(1px);
}

.compact-playground-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.compact-playground-btn svg {
  width: 14px;
  height: 14px;
  flex-shrink: 0;
}

/* Run button specific */
.compact-playground-run {
  background: var(--run-btn-bg, #4caf50);
  color: var(--run-btn-text, #fff);
  border-color: var(--run-btn-border, #43a047);
}

.compact-playground-run:hover:not(:disabled) {
  background: var(--run-btn-hover-bg, #43a047);
  border-color: var(--run-btn-hover-border, #388e3c);
}

.compact-playground-run.loading {
  background: var(--run-btn-loading-bg, #78909c);
  border-color: var(--run-btn-loading-border, #607d8b);
}

/* Copy button specific */
.compact-playground-copy.success {
  background: var(--success-bg, #e8f5e9);
  color: var(--success-color, #2e7d32);
  border-color: var(--success-border, #a5d6a7);
}

/* Output container */
.compact-output {
  padding: 0.75rem 1rem;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 0.875rem;
  line-height: 1.5;
  border-top: 1px solid var(--border-color, #e0e0e0);
  background: var(--output-bg, #fafafa);
}

.compact-output.loading {
  background: var(--loading-bg, #f5f5f5);
  color: var(--loading-color, #666);
}

.compact-output.success {
  background: var(--success-output-bg, #e8f5e9);
  border-color: var(--success-border, #a5d6a7);
}

.compact-output.error {
  background: var(--error-output-bg, #ffebee);
  border-color: var(--error-border, #ef9a9a);
}

/* Output header */
.compact-output-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.compact-output.success .compact-output-header {
  color: var(--success-header-color, #2e7d32);
}

.compact-output.error .compact-output-header {
  color: var(--error-header-color, #c62828);
}

.compact-output-header svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

/* Error items */
.compact-output-errors {
  margin-top: 0.5rem;
}

.compact-error-item {
  padding: 0.5rem;
  margin: 0.25rem 0;
  background: var(--error-item-bg, rgba(198, 40, 40, 0.1));
  border-radius: 4px;
  border-left: 3px solid var(--error-color, #c62828);
}

.compact-error-location {
  display: inline-block;
  padding: 0.1rem 0.4rem;
  margin-right: 0.5rem;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--location-color, #fff);
  background: var(--location-bg, #c62828);
  border-radius: 3px;
}

.compact-error-message {
  color: var(--error-message-color, #333);
}

/* Warnings */
.compact-output-warnings {
  margin-top: 0.5rem;
  padding: 0.5rem;
  background: var(--warning-bg, rgba(255, 152, 0, 0.1));
  border-radius: 4px;
  border-left: 3px solid var(--warning-color, #ff9800);
}

.compact-output-warnings ul {
  margin: 0.5rem 0 0 1.5rem;
  padding: 0;
}

.compact-output-warnings li {
  margin: 0.25rem 0;
}

/* Meta information */
.compact-output-meta {
  margin-top: 0.5rem;
  font-size: 0.8rem;
  color: var(--meta-color, #666);
}

/* Message */
.compact-output-message {
  white-space: pre-wrap;
  word-break: break-word;
}

/* Note about wrapped snippets */
.compact-output-note {
  margin: 0.5rem 0;
  padding: 0.4rem 0.75rem;
  font-size: 0.8rem;
  color: var(--note-color, #5c6bc0);
  background: var(--note-bg, rgba(92, 107, 192, 0.1));
  border-radius: 4px;
  border-left: 3px solid var(--note-border, #5c6bc0);
}

/* ============================================
   Dark theme support
   ============================================ */

/* mdBook navy/ayu/coal themes */
.navy .compact-playground-wrapper,
.ayu .compact-playground-wrapper,
.coal .compact-playground-wrapper,
[data-theme="dark"] .compact-playground-wrapper,
.dark-mode .compact-playground-wrapper {
  background: #2b303b !important;
  border-color: #3b4048 !important;
  --code-bg: #2b303b;
  --code-focus-bg: rgba(255, 255, 255, 0.03);
  --toolbar-bg: #1f232a;
  --border-color: #3b4048;
  --btn-bg: #3b4048;
  --btn-text: #c0c5ce;
  --btn-hover-bg: #4a505a;
  --btn-hover-border: #5a6068;
  --run-btn-bg: #388e3c;
  --run-btn-text: #fff;
  --run-btn-border: #2e7d32;
  --run-btn-hover-bg: #2e7d32;
  --run-btn-hover-border: #1b5e20;
  --run-btn-loading-bg: #455a64;
  --run-btn-loading-border: #37474f;
  --output-bg: #1f232a;
  --loading-bg: #252a33;
  --loading-color: #8a9199;
  --success-output-bg: rgba(46, 125, 50, 0.15);
  --success-border: rgba(46, 125, 50, 0.4);
  --success-header-color: #66bb6a;
  --success-bg: rgba(46, 125, 50, 0.2);
  --success-color: #66bb6a;
  --error-output-bg: rgba(198, 40, 40, 0.15);
  --error-border: rgba(198, 40, 40, 0.4);
  --error-header-color: #ef5350;
  --error-item-bg: rgba(198, 40, 40, 0.15);
  --error-color: #ef5350;
  --location-bg: #c62828;
  --location-color: #fff;
  --error-message-color: #e0e0e0;
  --warning-bg: rgba(255, 152, 0, 0.15);
  --warning-color: #ffb74d;
  --meta-color: #8a9199;
  --note-color: #7986cb;
  --note-bg: rgba(121, 134, 203, 0.15);
  --note-border: #7986cb;
  --editable-color: #8a9199;
  --editable-bg: rgba(255, 255, 255, 0.08);
}

/* Dark theme code text color and background */
.navy .compact-playground-wrapper pre,
.ayu .compact-playground-wrapper pre,
.coal .compact-playground-wrapper pre,
[data-theme="dark"] .compact-playground-wrapper pre,
.dark-mode .compact-playground-wrapper pre {
  background: transparent !important;
  background-color: transparent !important;
}

.navy .compact-playground-wrapper pre code,
.ayu .compact-playground-wrapper pre code,
.coal .compact-playground-wrapper pre code,
[data-theme="dark"] .compact-playground-wrapper pre code,
.dark-mode .compact-playground-wrapper pre code,
.navy .compact-playground-wrapper pre code.hljs,
.ayu .compact-playground-wrapper pre code.hljs,
.coal .compact-playground-wrapper pre code.hljs,
.navy .compact-playground-wrapper .hljs,
.ayu .compact-playground-wrapper .hljs,
.coal .compact-playground-wrapper .hljs {
  color: #cdd6f4;
  background: transparent !important;
  background-color: transparent !important;
}

/* Dark theme toolbar */
.navy .compact-playground-toolbar,
.ayu .compact-playground-toolbar,
.coal .compact-playground-toolbar {
  background: #1f232a !important;
  border-bottom-color: #3b4048 !important;
}

/* ============================================
   Responsive adjustments
   ============================================ */

@media (max-width: 600px) {
  .compact-playground-toolbar {
    flex-wrap: wrap;
  }

  .compact-playground-btn span {
    display: none;
  }

  .compact-playground-btn {
    padding: 0.5rem;
  }
}

/* ============================================
   Animation for loading
   ============================================ */

@keyframes compact-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.compact-playground-run.loading svg {
  animation: compact-spin 1s linear infinite;
}

/* ============================================
   Print styles
   ============================================ */

@media print {
  .compact-playground-toolbar {
    display: none;
  }

  .compact-output {
    border: 1px solid #ccc;
  }
}

/* ============================================
   Toast Notifications
   ============================================ */

.compact-toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 10000;
  display: flex;
  flex-direction: column;
  gap: 10px;
  pointer-events: none;
}

.compact-toast {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 20px;
  min-width: 280px;
  max-width: 420px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12), 0 4px 10px rgba(0, 0, 0, 0.08);
  border-left: 4px solid transparent;
  pointer-events: auto;
  transform: translateX(120%);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.compact-toast.show {
  transform: translateX(0);
  opacity: 1;
}

.compact-toast.hide {
  transform: translateX(120%);
  opacity: 0;
}

.compact-toast-icon {
  flex-shrink: 0;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.compact-toast-icon svg {
  width: 16px;
  height: 16px;
}

.compact-toast-content {
  flex: 1;
}

.compact-toast-title {
  font-weight: 700;
  font-size: 0.95rem;
  margin-bottom: 2px;
  color: #1a1a1a;
}

.compact-toast-message {
  font-size: 0.85rem;
  color: #666;
  line-height: 1.4;
}

.compact-toast-close {
  flex-shrink: 0;
  width: 24px;
  height: 24px;
  border: none;
  background: transparent;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #999;
  transition: all 0.2s;
}

.compact-toast-close:hover {
  background: rgba(0, 0, 0, 0.05);
  color: #333;
}

/* Success toast */
.compact-toast.success {
  border-left-color: #10b981;
  background: linear-gradient(135deg, #ecfdf5 0%, #fff 100%);
}

.compact-toast.success .compact-toast-icon {
  background: #10b981;
  color: #fff;
}

.compact-toast.success .compact-toast-title {
  color: #065f46;
}

/* Error toast */
.compact-toast.error {
  border-left-color: #ef4444;
  background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);
}

.compact-toast.error .compact-toast-icon {
  background: #ef4444;
  color: #fff;
}

.compact-toast.error .compact-toast-title {
  color: #991b1b;
}

/* Warning toast */
.compact-toast.warning {
  border-left-color: #f59e0b;
  background: linear-gradient(135deg, #fffbeb 0%, #fff 100%);
}

.compact-toast.warning .compact-toast-icon {
  background: #f59e0b;
  color: #fff;
}

.compact-toast.warning .compact-toast-title {
  color: #92400e;
}

/* Dark theme toast adjustments */
.ayu .compact-toast,
.navy .compact-toast,
.coal .compact-toast {
  background: #2d2d2d;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
}

.ayu .compact-toast-title,
.navy .compact-toast-title,
.coal .compact-toast-title {
  color: #e0e0e0;
}

.ayu .compact-toast-message,
.navy .compact-toast-message,
.coal .compact-toast-message {
  color: #aaa;
}

.ayu .compact-toast.success,
.navy .compact-toast.success,
.coal .compact-toast.success {
  background: linear-gradient(135deg, #064e3b 0%, #2d2d2d 100%);
}

.ayu .compact-toast.success .compact-toast-title,
.navy .compact-toast.success .compact-toast-title,
.coal .compact-toast.success .compact-toast-title {
  color: #6ee7b7;
}

.ayu .compact-toast.error,
.navy .compact-toast.error,
.coal .compact-toast.error {
  background: linear-gradient(135deg, #7f1d1d 0%, #2d2d2d 100%);
}

.ayu .compact-toast.error .compact-toast-title,
.navy .compact-toast.error .compact-toast-title,
.coal .compact-toast.error .compact-toast-title {
  color: #fca5a5;
}

/* Toast progress bar */
.compact-toast-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: currentColor;
  opacity: 0.3;
  border-radius: 0 0 0 10px;
  animation: toast-progress 4s linear forwards;
}

@keyframes toast-progress {
  from {
    width: 100%;
  }
  to {
    width: 0%;
  }
}

/* Responsive toast */
@media (max-width: 480px) {
  .compact-toast-container {
    left: 10px;
    right: 10px;
    top: 10px;
  }

  .compact-toast {
    min-width: auto;
    max-width: none;
  }
}
